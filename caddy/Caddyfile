{
	debug
	email {env.ACME_EMAIL}
}

(security_headers) {
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-XSS-Protection "1; mode=block"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "sameorigin"
		X-Robots-Tag "noindex, noarchive, nofollow"
	}
}

(forwarding_headers) {
	header_up Host {upstream_hostport}
	header_up X-Forwarded-Host {host}
	header_up X-Real-IP {remote_host}
	header_up X-Forwarded-For {remote_host}
}

*.{$DOMAIN_NAME} {
	tls {$ACME_EMAIL} {
		dns namecheap {
			api_key {env.NAMECHEAP_API_KEY}
			user {env.NAMECHEAP_USERNAME}
			endpoint {env.NAMECHEAP_ENDPOINT}
		}
	}
}

hello.{$DOMAIN_NAME} {
	import security_headers
	respond "Hello"
}

www.{$DOMAIN_NAME} {
	import security_headers
	root * /www/
	file_server
}

gitlab.{$DOMAIN_NAME} {
	import security_headers
	reverse_proxy gitlab:80 {
		import forwarding_headers
	}
}

registry.{$DOMAIN_NAME} {
	# import security_headers
	reverse_proxy gitlab:5000 {
		import forwarding_headers
	}
}
