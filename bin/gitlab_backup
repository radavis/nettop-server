#!/bin/sh

destination=${BACKUP_PATH:-"$(pwd)/.backup"}

container=gitlab
image=gitlab:nettop

docker run --rm \
  --entrypoint "/bin/tar" \
  --volumes-from ${container} \
  -v ${destination}:/backup \
  ${image} \
  "-cf" "/backup/gitlab-config-${timestamp}.tar" "-C" "/" "etc/gitlab"

docker run --rm \
  --entrypoint "/bin/tar" \
  --volumes-from ${container} \
  -v ${destination}:/backup \
  ${image} \
  "-cf" "/backup/gitlab-logs-${timestamp}.tar" "-C" "/" "var/log/gitlab"

docker run --rm \
  --entrypoint "/bin/tar" \
  --volumes-from ${container} \
  -v ${destination}:/backup \
  ${image} \
  "-cf" "/backup/gitlab-data-${timestamp}.tar" "-C" "/" "var/opt/gitlab"
