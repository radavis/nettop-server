#!/bin/sh

destination=${BACKUP_PATH:-"$(pwd)/.backup"}

container=caddy
image=nettop-server_caddy:latest

timestamp=$(env TZ=UTC date "+%Y%m%d%H%M%S")

docker run --rm \
  --entrypoint "/bin/tar" \
  --volumes-from ${container} \
  -v ${destination}:/backup \
  ${image} \
  "-cf" "/backup/${container}-data-${timestamp}.tar" "-C" "/" "data"

docker run --rm \
  --entrypoint "/bin/tar" \
  --volumes-from ${container} \
  -v ${destination}:/backup \
  ${image} \
  "-cf" "/backup/${container}-config-${timestamp}.tar" "-C" "/" "config"
